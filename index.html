<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <div class="brand-icon">üìö</div>
                <div class="brand-text">
                    <h1 id="headerTitle">Attendance Management System</h1>
                    <p id="headerSubtitle">Secure Login</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary theme-toggle" onclick="toggleTheme()" id="themeToggle">Toggle Theme</button>
            </div>
        </header>

        <div style="display:flex; gap:20px;">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="avatar">üéì</div>
                    <div class="user-info"><span id="sidebarUser">Guest</span></div>
                </div>
                <nav class="side-nav">
                    <button id="tab-dashboard" class="side-link active" onclick="showTab(event, 'dashboard')">üè† Overview</button>
                    <button id="tab-auth" class="side-link" onclick="showTab(event, 'auth')">üîê Login</button>
                    <button id="tab-attendance" class="side-link" onclick="showTab(event, 'attendance')">‚úÖ Upload Attendance</button>
                    <button id="tab-viewattendance" class="side-link" onclick="showTab(event, 'viewattendance')">üìÖ Check Attendance</button>
                    <button id="tab-students" class="side-link" onclick="showTab(event, 'students')">üë• Students</button>
                    <button id="tab-materials" class="side-link" onclick="showTab(event, 'materials')">üìÅ Download/Upload Materials</button>
                    <button id="tab-marks" class="side-link" onclick="showTab(event, 'marks')">üìù Check/Upload Marks</button>
                    <button id="tab-complaints" class="side-link" onclick="showTab(event, 'complaints')">üì£ Raise Complaints</button>
                    <button id="tab-reports" class="side-link" onclick="showTab(event, 'reports')">üìä Reports</button>
                    <button id="tab-admin" class="side-link" onclick="showTab(event, 'admin')">üõ†Ô∏è Admin Panel</button>
                    <button class="side-link" onclick="logoutUser()">üö™ Logout</button>
                </nav>
            </aside>
            <div style="flex:1">
                <nav id="studentTopNav" class="top-nav" style="display:none;">
                    <button class="top-link active" onclick="showTab(event, 'viewattendance')">üìÖ Check Attendance</button>
                    <button class="top-link" onclick="showTab(event, 'materials')">üìÅ Download Materials</button>
                    <button class="top-link" onclick="showTab(event, 'marks')">üìù Check Marks</button>
                    <button class="top-link" onclick="showTab(event, 'complaints')">üì£ Raise Complaints</button>
                    <span style="flex:1"></span>
                    <button class="top-link" onclick="logoutUser()">üö™ Logout</button>
                </nav>
                
                <div id="dashboard" class="tab-content active">
                    <div class="split-grid">
                        <div class="split-left">
                            <div class="section-header">
                                <h2>Attendance</h2>
                            </div>
                            <div class="form-container">
                                <div class="form-group">
                                    <label for="dashStudentId">Student ID</label>
                                    <div style="display:flex; gap:8px;">
                                        <input type="text" id="dashStudentId" placeholder="Enter your Student ID">
                                        <button class="btn btn-secondary" onclick="saveMyIdFromDashboard()">Save</button>
                                    </div>
                                </div>
                                <div id="studentDashCalendar"></div>
                                <div style="margin-top:8px; color:#666;">Attendance: <span id="studentDashPercent">0%</span></div>
                                <div style="margin-top:16px;" id="studentAttendanceRecords"></div>
                            </div>
                        </div>
                        <div class="split-right">
                            <div class="section-header">
                                <h2>Grades & Marks</h2>
                            </div>
                            <div class="table-container" id="studentDashMarks"></div>
                        </div>
                    </div>
                </div>

                
                <div id="viewattendance" class="tab-content">
                    <div class="section-header">
                        <h2>View Attendance</h2>
                        <div class="attendance-date">
                            <label for="calendarStudentId">Student ID</label>
                            <input type="text" id="calendarStudentId" placeholder="Enter your Student ID">
                            <button class="btn btn-secondary" onclick="loadAttendanceCalendar()">Load</button>
                        </div>
                    </div>
                    <div class="form-container">
                        <div id="attendanceCalendar"></div>
                    </div>
                </div>
                
                <div id="admin" class="tab-content">
                    <div class="section-header">
                        <h2>Admin Panel</h2>
                        <p>Manage classes and students</p>
                    </div>
                    <div class="form-container">
                        <h3>Create Class</h3>
                        <form onsubmit="createClassFromAdmin(event)">
                            <div class="form-group">
                                <label for="adminClassName">Class Name</label>
                                <input type="text" id="adminClassName" required>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Create</button>
                            </div>
                        </form>
                    </div>
                    <div class="students-list">
                        <h3>Registered Students</h3>
                        <div id="studentsTableAdmin" class="table-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="students" class="tab-content">
            <div class="section-header">
                <h2>Student Management</h2>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="text" id="studentSearch" placeholder="Search students" oninput="filterStudentsTable()" style="padding:10px; border:2px solid rgb(221,221,221); border-radius:8px;">
                    <button class="btn btn-primary" onclick="showAddStudentForm()">Add New Student</button>
                </div>
            </div>
            
            <div id="addStudentForm" class="form-container" style="display: none;">
                <h3>Add New Student</h3>
                <form onsubmit="addStudent(event)">
                    <div class="form-group">
                        <label for="studentName">Student Name:</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-group">
                        <label for="studentId">Student ID:</label>
                        <input type="text" id="studentId" required>
                    </div>
                    <div class="form-group">
                        <label for="studentEmail">Email:</label>
                        <input type="email" id="studentEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="studentClass">Class:</label>
                        <input type="text" id="studentClass" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Add Student</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddStudentForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="students-list">
                <h3>Registered Students</h3>
                <div id="studentsTable" class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Class</th>
                                <th>Attendance %</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="attendance" class="tab-content">
            <div class="section-header">
                <h2>Mark Attendance</h2>
            </div>
            <div class="split-grid">
                <div class="split-left">
                    <div class="form-container">
                        <div class="form-group">
                            <label for="attendanceDate">Date:</label>
                            <input type="date" id="attendanceDate" required>
                        </div>
                        <div class="form-group">
                            <label for="selectedClass">Select Class:</label>
                            <select id="selectedClass" onchange="loadStudentsForAttendance()">
                                <option value="">Select a class</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="attCsv">Upload Attendance CSV</label>
                            <input type="file" id="attCsv" accept=".csv">
                            <button class="btn btn-primary" style="margin-top:8px" onclick="uploadAttendanceCsv()">Upload CSV</button>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="loadStudentsForAttendance()">Load Students</button>
                        </div>
                    </div>
                </div>
                <div class="split-right">
                    <div id="attendanceList" class="attendance-list" style="display: none;">
                        <h3>Mark Attendance for <span id="className"></span></h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr><th>Student</th><th>Present</th><th>Absent</th><th>Late</th></tr>
                                </thead>
                                <tbody id="studentsAttendanceList"></tbody>
                            </table>
                        </div>
                        <div class="attendance-actions">
                            <button class="btn btn-success" onclick="markAllPresent()">Mark All Present</button>
                            <button class="btn btn-danger" onclick="markAllAbsent()">Mark All Absent</button>
                            <button class="btn btn-primary" onclick="saveAttendance()">Save Attendance</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div class="section-header">
                <h2>Attendance Reports</h2>
                <div class="report-filters">
                    <select id="reportClass">
                        <option value="">All Classes</option>
                    </select>
                    <select id="reportPeriod">
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
            </div>
            
            <div class="reports-grid">
                <div class="report-card">
                    <h3>Individual Report</h3>
                    <select id="individualStudent">
                        <option value="">Select Student</option>
                    </select>
                    <button class="btn btn-primary" onclick="generateIndividualReport()">Generate Report</button>
                    <button class="btn btn-success" onclick="downloadIndividualReport()" id="downloadIndividualBtn" style="display: none;">üì• Download Report</button>
                    <button class="btn btn-secondary" onclick="downloadIndividualCSV()" id="downloadIndividualCsvBtn" style="display: none;">üìÑ Download CSV</button>
                    <div id="individualReport" class="report-content"></div>
                </div>
                
                <div class="report-card">
                    <h3>Class Report</h3>
                    <select id="classReport">
                        <option value="">Select Class</option>
                    </select>
                    <button class="btn btn-primary" onclick="generateClassReport()">Generate Report</button>
                    <button class="btn btn-success" onclick="downloadClassReport()" id="downloadClassBtn" style="display: none;">üì• Download Report</button>
                    <button class="btn btn-secondary" onclick="downloadClassCSV()" id="downloadClassCsvBtn" style="display: none;">üìÑ Download CSV</button>
                    <div id="classReportContent" class="report-content"></div>
                </div>
                
                <div class="report-card">
                    <h3>Overall Statistics</h3>
                    <button class="btn btn-primary" onclick="generateOverallStats()">Generate Stats</button>
                    <button class="btn btn-success" onclick="downloadOverallStats()" id="downloadOverallBtn" style="display: none;">üì• Download Report</button>
                    <button class="btn btn-secondary" onclick="downloadOverallCSV()" id="downloadOverallCsvBtn" style="display: none;">üìÑ Download CSV</button>
                    <div id="overallStats" class="report-content"></div>
                </div>
            </div>
        </div>

        <div id="data" class="tab-content">
            <div class="section-header">
                <h2>Data Management</h2>
                <p>Manage your attendance data and localStorage</p>
            </div>
            
            <div class="data-management-grid">
                <div class="data-card">
                    <h3>Storage Information</h3>
                    <div id="storageInfo" class="storage-info">
                        <p><strong>Storage Status:</strong> <span id="storageStatus">Checking...</span></p>
                        <p><strong>Total Students:</strong> <span id="storageStudents">0</span></p>
                        <p><strong>Data Size:</strong> <span id="storageSize">0 KB</span></p>
                        <p><strong>Last Updated:</strong> <span id="lastUpdated">Never</span></p>
                    </div>
                </div>
                
                <div class="data-card">
                    <h3>Data Actions</h3>
                    <div class="data-actions">
                        <button class="btn btn-primary" onclick="saveDataToStorage(); updateStorageInfo(); showMessage('Data saved successfully!', 'success')">
                            üíæ Save Data
                        </button>
                        <button class="btn btn-secondary" onclick="loadDataFromStorage(); updateDashboard(); updateClassDropdowns(); updateStudentDropdowns(); updateStudentsTable(); updateStorageInfo(); showMessage('Data loaded successfully!', 'success')">
                            üìÇ Load Data
                        </button>
                        <button class="btn btn-success" onclick="exportData()">
                            üì§ Export Data
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData(); updateStorageInfo()">
                            üóëÔ∏è Clear All Data
                        </button>
                    </div>
                </div>
                
                <div class="data-card">
                    <h3>localStorage Details</h3>
                    <div class="localStorage-details">
                        <p><strong>localStorage Status:</strong> <span id="localStorageStatus">Checking...</span></p>
                        <p><strong>Browser Support:</strong> <span id="browserSupport">Checking...</span></p>
                        <p><strong>Available Space:</strong> <span id="availableSpace">Unknown</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="auth" class="tab-content">
            <div class="section-header">
                <h2>Account</h2>
            </div>
            <div class="auth-grid">
                <div class="auth-card">
                    <h3>Login</h3>
                    <form onsubmit="loginUser(event)">
                        <label for="loginEmail">Email</label>
                        <input class="input" type="email" id="loginEmail" placeholder="email@example.com" required>
                        <label style="margin-top:10px" for="loginPassword">Password</label>
                        <input class="input" type="password" id="loginPassword" placeholder="Enter password" required>
                        <div id="errorBox" class="error" style="display:none">Invalid email or password!</div>
                        <div class="form-actions" style="justify-content:flex-start">
                            <button type="submit" class="btn btn-submit">Login</button>
                            <button type="button" class="btn btn-back" onclick="openRegister()">Create New Account</button>
                        </div>
                    </form>
                    <div id="authStatus" class="auth-status"></div>
                    <div class="form-actions" id="logoutActions" style="display:none;">
                        <button type="button" class="btn btn-secondary" onclick="logoutUser()">Logout</button>
                    </div>
                </div>

                <div class="auth-card" id="registerCard" style="display:none;">
                    <h3>Register</h3>
                    <form onsubmit="registerUser(event)">
                        <label for="regName">Name</label>
                        <input class="input" type="text" id="regName" placeholder="Your name" required>
                        <label style="margin-top:10px" for="regEmail">Email</label>
                        <input class="input" type="email" id="regEmail" placeholder="email@example.com" required>
                        <label style="margin-top:10px" for="regPassword">Password</label>
                        <input class="input" type="password" id="regPassword" placeholder="6+ character password" required>
                        <label style="margin-top:10px" for="regRole">Select Role</label>
                        <select class="input" id="regRole" required>
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                        </select>
                        <div class="form-actions" style="justify-content:flex-start">
                            <button type="submit" class="btn btn-submit">Register</button>
                            <button type="button" class="btn btn-back" onclick="closeRegister()">Back to Login</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div id="materials" class="tab-content">
            <div class="section-header">
                <h2>Materials</h2>
            </div>
            <div class="auth-grid">
                <div class="auth-card">
                    <h3>Upload Material (Teacher)</h3>
                    <form onsubmit="addMaterial(event)">
                        <div class="form-group">
                            <label for="matTitle">Title</label>
                            <input type="text" id="matTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="materialFileInput">Choose File</label>
                            <input type="file" id="materialFileInput">
                        </div>
                        <div class="form-group">
                            <label for="matUrl">File URL</label>
                            <input type="url" id="matUrl" required>
                        </div>
                        <div class="form-group">
                            <label for="matDesc">Description</label>
                            <input type="text" id="matDesc">
                        </div>
                        <div class="form-group">
                            <label for="matClass">Class ID (optional)</label>
                            <input type="text" id="matClass">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Upload</button>
                        </div>
                    </form>
                </div>
                <div class="auth-card">
                    <h3>Available Materials</h3>
                    <div id="materialsList" class="table-container"></div>
                </div>
            </div>
        </div>

        <div id="marks" class="tab-content">
            <div class="section-header">
                <h2>Marks</h2>
            </div>
            <div class="auth-grid">
                <div class="auth-card">
                    <h3>Upload Marks (Teacher)</h3>
                    <form onsubmit="addMark(event)">
                        <div class="form-group">
                            <label for="markStudentId">Student ID</label>
                            <input type="text" id="markStudentId" required>
                        </div>
                        <div class="form-group">
                            <label for="markSubject">Subject</label>
                            <input type="text" id="markSubject" required>
                        </div>
                        <div class="form-group">
                            <label for="markScore">Score</label>
                            <input type="number" step="0.01" id="markScore" required>
                        </div>
                        <div class="form-group">
                            <label for="markMax">Max Score</label>
                            <input type="number" step="0.01" id="markMax" required>
                        </div>
                        <div class="form-group">
                            <label for="marksCsv">Upload Marks CSV</label>
                            <input type="file" id="marksCsv" accept=".csv">
                            <button type="button" class="btn btn-primary" style="margin-top:8px" onclick="uploadMarksCsv()">Upload Marks CSV</button>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Upload</button>
                        </div>
                    </form>
                </div>
                <div class="auth-card">
                    <h3>My Marks (Student)</h3>
                    <div class="form-group">
                        <label for="viewMarksStudentId">Student ID</label>
                        <input type="text" id="viewMarksStudentId">
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="loadMyMarks()">Load Marks</button>
                    </div>
                    <div id="marksList" class="table-container"></div>
                </div>
            </div>
        </div>

        <div id="complaints" class="tab-content">
            <div class="section-header">
                <h2>Raise a Complaint</h2>
            </div>
            <div class="split-grid">
                <div class="split-left">
                    <div class="form-container">
                        <form onsubmit="submitComplaint(event)">
                            <div class="form-group">
                                <label for="complaintSubject">Subject</label>
                                <input type="text" id="complaintSubject" required>
                            </div>
                            <div class="form-group">
                                <label for="complaintMessage">Description</label>
                                <input type="text" id="complaintMessage" required>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" style="width:100%">Submit</button>
                            </div>
                        </form>
                        <h3 style="margin-top:16px;">My Complaints</h3>
                        <div id="myComplaintsList" class="table-container"></div>
                    </div>
                </div>
                <div class="split-right">
                    <div class="section-header">
                        <h2>Course Materials</h2>
                    </div>
                    <div id="materialsSlimList" class="table-container"></div>
                </div>
            </div>
        </div>

        <div id="myattendance" class="tab-content">
            <div class="section-header">
                <h2>My Attendance</h2>
            </div>
            <div class="auth-card">
                <h3>Self Mark (24 hrs)</h3>
                <form onsubmit="selfMarkAttendance(event)">
                    <div class="form-group">
                        <label for="selfStudentId">Student ID</label>
                        <input type="text" id="selfStudentId" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Mark Present</button>
                    </div>
                </form>
                <div id="selfMarkStatus" class="auth-status"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="developer-link">
                <a class="devepLink" href="https://portfolio-new-drab-pi.vercel.app">< Developer ></a>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    
</body>
</html>
